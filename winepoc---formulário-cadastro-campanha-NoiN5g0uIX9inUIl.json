{"createdAt":"2024-05-09T14:02:22.928Z","updatedAt":"2024-05-10T00:01:02.000Z","id":"NoiN5g0uIX9inUIl","name":"WinePOC - Formulário Cadastro Campanha","active":true,"nodes":[{"parameters":{"respondWith":"text","responseBody":"={{$json[\"html\"]}}","options":{"responseHeaders":{"entries":[{"name":"Content-Type","value":"text/html; charset=UTF-8"},{"name":"Control-Allow-Origin","value":"*"}]}}},"id":"0faec9c9-4df7-44b8-b7c7-b1f9791bf68c","name":"Respond to Webhook","type":"n8n-nodes-base.respondToWebhook","typeVersion":1.1,"position":[720,280]},{"parameters":{"jsCode":"const htmlCode = `\n<!DOCTYPE html>\n<html lang=\"pt-br\">\n<head>\n<meta charset=\"UTF-8\">\n<meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n<title>WinePOC</title>\n<link rel=\"stylesheet\" href=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css\">\n<link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/css/bootstrap-datepicker.min.css\">\n<style>\n    .edit-btn,\n    .delete-btn {\n        cursor: pointer;\n    }\n\t\n</style>\n</head>\n<body>\n\n<div class=\"container mt-5\">\n    <h2 class=\"mb-4\">WinePOC - Cadastro de Campanha</h2>\n\n    <div class=\"form-row\">\n        <div class=\"col-md-4 mb-3\">\n            <input type=\"text\" class=\"form-control\" id=\"tituloCampanha\" placeholder=\"Título da Campanha\" required>\n        </div>\n\t\t<div class=\"col-md-3 mb-3\">\n\t\t\t<input type=\"text\" class=\"form-control datepicker\" id=\"validadeCampanha\" placeholder=\"Data de Validade\" required>\n\t\t</div>\n    </div>\n\n    <h4 class=\"mb-4\">Adicionar Produtos</h4>\n    <div class=\"form-row\">\n        <div class=\"col-md-3 mb-3\">\n            <input type=\"text\" class=\"form-control\" id=\"productName\" placeholder=\"Nome do Produto\" required>\n        </div>\n\t\t<div class=\"col-md-2 mb-2\">\n            <input type=\"number\" class=\"form-control\" id=\"productYear\" placeholder=\"Ano / Safra\" required>\n        </div>\n        <div class=\"col-md-2 mb-2\">\n            <input type=\"number\" class=\"form-control\" id=\"productPrice\" placeholder=\"Preço do Produto\" required>\n        </div>\n        <div class=\"col-md-4\">\n            <button type=\"button\" class=\"btn btn-primary btn-block\" onclick=\"addProduct()\">Adicionar Produto</button>\n        </div>\n    </div>\n\n    <table id=\"productTable\" class=\"table\">\n        <thead>\n            <tr>\n                <th>Nome do Produto</th>\n                <th>Ano / Safra</th>\n                <th>Preço do Produto</th>\n                <th>Ações</th>\n            </tr>\n        </thead>\n        <tbody>\n            <!-- Linhas da tabela serão adicionadas aqui -->\n        </tbody>\n    </table>\n\t<form id=\"productForm\" class=\"mb-4\">\n\t\t<div class=\"form-row\">\n\t\t\t<div class=\"col-md-3\">\n\t\t\t\t<button type=\"submit\" class=\"btn btn-success btn-block\">Cadastrar e Disparar Campanha</button>\n\t\t\t</div>\n\t\t</div>\n\t</form>\n</div>\n\n<!-- Modal de Edição -->\n<div class=\"modal fade\" id=\"editModal\" tabindex=\"-1\" role=\"dialog\" aria-labelledby=\"editModalLabel\" aria-hidden=\"true\">\n    <div class=\"modal-dialog\" role=\"document\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h5 class=\"modal-title\" id=\"editModalLabel\">Editar Produto</h5>\n                <button type=\"button\" class=\"close\" data-dismiss=\"modal\" aria-label=\"Close\">\n                    <span aria-hidden=\"true\">&times;</span>\n                </button>\n            </div>\n            <div class=\"modal-body\">\n                <input type=\"hidden\" id=\"editProductId\">\n                <div class=\"form-group\">\n                    <label for=\"editProductName\">Nome do Produto:</label>\n                    <input type=\"text\" class=\"form-control\" id=\"editProductName\">\n                </div>\n\t\t\t\t<div class=\"form-group\">\n                    <label for=\"editProductName\">Ano / Safra:</label>\n                    <input type=\"text\" class=\"form-control\" id=\"editProductYear\">\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"editProductPrice\">Preço do Produto:</label>\n                    <input type=\"number\" class=\"form-control\" id=\"editProductPrice\">\n                </div>\n            </div>\n            <div class=\"modal-footer\">\n                <button type=\"button\" class=\"btn btn-secondary\" data-dismiss=\"modal\">Fechar</button>\n                <button type=\"button\" class=\"btn btn-primary\" onclick=\"saveEdit()\">Salvar Mudanças</button>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src=\"https://code.jquery.com/jquery-3.5.1.slim.min.js\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js\"></script>\n<script src=\"https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.9.0/js/bootstrap-datepicker.min.js\"></script>\n<script>\n\n    $(document).ready(function() {\n        // Inicializar datepicker\n        $(\"#validadeCampanha\").datepicker({\n            format: \"dd/mm/yyyy\",\n            autoclose: true,\n            todayHighlight: true\n        });\n\n        $(\"#productForm\").submit(function(event) {\n\t\t\tchamarAPI();\n        });\n    });\n\t\n\t\n\n    function addProduct() {\n        // Obter os valores dos campos do formulário\n        var productName = $(\"#productName\").val();\n        var productYear = $(\"#productYear\").val();\n        var productPrice = parseFloat($(\"#productPrice\").val()).toFixed(2);\n\n        // Validar se os campos não estão vazios\n        if (productName === \"\" || productYear === \"\" || isNaN(productYear) || productPrice === \"\" || isNaN(productPrice)) {\n            alert(\"Por favor, preencha todos os campos com valores válidos.\");\n            return;\n        }\n\n        // Adicionar o produto à tabela\n        var newRow = '<tr>' +\n                        '<td>' + productName + '</td>' +\n                        '<td>' + productYear + '</td>' +\n                        '<td>R$' + productPrice + '</td>' +\n                        '<td>' +\n                            '<span class=\"edit-btn text-primary mr-2\" onclick=\"editProduct(this)\">Editar</span>' +\n                            '<span class=\"delete-btn text-danger\" onclick=\"deleteProduct(this)\">Excluir</span>' +\n                        '</td>' +\n                    '</tr>';\n        $(\"#productTable tbody\").append(newRow);\n\n        // Limpar os campos do formulário\n        $(\"#productName\").val(\"\");\n        $(\"#productYear\").val(\"\");\n        $(\"#productPrice\").val(\"\");\n    }\n\n    function editProduct(element) {\n        var row = $(element).closest(\"tr\");\n        var name = row.find(\"td:eq(0)\").text();\n        var year = row.find(\"td:eq(1)\").text();\n        var price = parseFloat(row.find(\"td:eq(1)\").text().replace(\"R$\", \"\"));\n\n        $(\"#editProductName\").val(name);\n        $(\"#editProductYear\").val(name);\n        $(\"#editProductPrice\").val(price);\n        $(\"#editProductId\").val(row.index());\n\n        $(\"#editModal\").modal(\"show\");\n    }\n\n    function saveEdit() {\n        var newName = $(\"#editProductName\").val();\n        var newYear = $(\"#editProductYear\").val();\n        var newPrice = parseFloat($(\"#editProductPrice\").val()).toFixed(2);\n        var rowIndex = $(\"#editProductId\").val();\n\n        if (newName === \"\" || newYear === \"\" || isNaN(newYear) || newPrice === \"\" || isNaN(newPrice)) {\n            alert(\"Por favor, preencha todos os campos com valores válidos.\");\n            return;\n        }\n\n        $(\"#productTable tbody tr\").eq(rowIndex).find(\"td:eq(0)\").text(newName);\n        $(\"#productTable tbody tr\").eq(rowIndex).find(\"td:eq(1)\").text(newYear);\n        $(\"#productTable tbody tr\").eq(rowIndex).find(\"td:eq(2)\").text(\"R$\" + newPrice);\n\n        $(\"#editModal\").modal(\"hide\");\n    }\n\n    function deleteProduct(element) {\n        $(element).closest(\"tr\").remove();\n    }\n\t\n\tfunction chamarAPI() {\n\t\tvar campanha = $(\"#tituloCampanha\").val();\n\t\tvar validade = converterParaISO($(\"#validadeCampanha\").val());\n\t\t\n        $(\"#productTable tbody tr\").each(function() {\n            var nome = $(this).find(\"td:eq(0)\").text();\n            var ano = $(this).find(\"td:eq(1)\").text();\n            var preco = parseFloat($(this).find(\"td:eq(2)\").text().replace(\"R$\", \"\"));\n\n            // Construir o objeto de dados para enviar na chamada da API\n            var data = {\n\t\t\t\t\"Campanha\": campanha, \n                \"Rotulo\": nome,\n                \"Ano\": Number(ano),\n                \"Preco\": preco.toFixed(2),\n\t\t\t\t\"Validade\": validade\n            };\n\n\t\t\t// Fazer a chamada à API usando fetch\n            fetch(\"https://api.baserow.io/api/database/rows/table/295819/?user_field_names=true\", {\n                method: \"POST\",\n                headers: {\n                    \"Authorization\": \"Token RTVh6GDvrN3bzKlNbx0EpNYFboBywIVq\", \n                    \"Content-Type\": \"application/json\"\n                },\n                body: JSON.stringify(data)\n            })\n            .then(async response => {\n                if (!response.ok) {\n                    throw new Error(\"Erro ao enviar produto para a API\");\n                }\n                return await response.json();\n            })\n            .then(data => {\n                console.log(\"Produto enviado para a API com sucesso:\", data);\n            })\n            .catch(error => {\n                console.error(error.message);\n            });\n        });\n    }\n\n\tfunction converterParaISO(dataString) {\n\t\t// Dividir a string da data em dia, mês e ano\n\t\tvar partes = dataString.split('/');\n\t\t// Construir uma nova data usando ano, mês e dia\n\t\tvar novaData = new Date(partes[2], partes[1] - 1, partes[0]);\n\t\t// Extrair a parte da data em formato ISO e remover o tempo\n\t\tvar dataISO = novaData.toISOString().split('T')[0];\n\t\t// Retornar a data formatada para o formato ISO sem tempo\n\t\treturn dataISO;\n\t}\t\n</script>\n\n</body>\n</html>\n`;\n\nreturn [{\n  json: {\n    html: htmlCode\n  }\n}];"},"id":"3bea95be-2085-409d-a1c5-a485c8b2cd1f","name":"HTML","type":"n8n-nodes-base.code","typeVersion":2,"position":[440,280]},{"parameters":{"path":"winepoc/campanha","responseMode":"responseNode","options":{}},"id":"0c624b77-0d6c-46b4-9ee6-6e1fffb97a5c","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[160,280],"webhookId":"ed42af3a-0cf7-4091-9d69-b46021e826c7"}],"connections":{"HTML":{"main":[[{"node":"Respond to Webhook","type":"main","index":0}]]},"Webhook":{"main":[[{"node":"HTML","type":"main","index":0}]]}},"settings":{"executionOrder":"v1"},"staticData":null,"meta":{"templateCredsSetupCompleted":true},"pinData":{},"versionId":"8a6e0163-1784-44dc-8cb9-e4a6ec9b454c","triggerCount":1,"tags":[]}